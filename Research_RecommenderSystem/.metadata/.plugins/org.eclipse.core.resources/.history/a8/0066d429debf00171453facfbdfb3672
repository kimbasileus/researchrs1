package hyu.kskim.recomsys.prepare.movielens;

import java.io.BufferedReader;
import java.io.FileReader;

import hyu.kskim.recomsys.prepare.utils.DBManager;
import hyu.kskim.recomsys.prepare.utils.FileIO;

public class MovieLensDataset {
	String path = "D:\\Research_LibraryDataSet\\Dataset\\MovieLens_small";
	String dbId = "root";
	String dbPw = "kyungsookim";
	DBManager db = new DBManager(null, null, null);
	FileIO file = new FileIO();
	
	public MovieLensDataset() {
		db.connectDB("root", "kyungsookim");
		
	}
	
	public void loadRatingDataSetIntoDB() {
		// 1. Loading & Write DB ratings datasets (ratings.csv)
		String dir = path+"\\ratings.csv";
		try{
			 BufferedReader reader = new BufferedReader(new FileReader(dir));
			 String inputLine = null;
			 
			 String temp[] = null; int userID; int itemID; double rating; int timestamp;
			 int count = -1;
			 while ((inputLine = reader.readLine()) != null){
				 if(count==-1) {
					 count++;
					 continue;
				 }
				 //System.out.println(inputLine);
			     //buffer.append(inputLine);
				
				 temp = inputLine.split(",");
				 if(temp.length != 4) continue;
				 
				 userID = Integer.parseInt(temp[0]);
				 itemID = Integer.parseInt(temp[1]);
				 rating = Double.parseDouble(temp[2]);
				 timestamp = Integer.parseInt(temp[3]);
				 
				 count++;
				 System.out.println("["+count+"] \t"+userID+"\t"+itemID+"\t"+rating+"\t"+timestamp);
				 
				 db.getStmt().executeUpdate("INSERT INTO `movielens`.`ratings` (`userID`, `itemID`, `rating`, `timestamp`) "
				 		+ "VALUES ('"+userID+"', '"+itemID+"', '"+rating+"', '"+timestamp+"');");
				 //System.exit(0);
			 }
			 reader.close();
			 //System.out.println(buffer.toString());
			 
		}catch(Exception e){
			System.err.println("loadRatingDataSetIntoDB error: "+e.getMessage());
		}
	}
	
	
	
	
	
	public void loadMovieContentDataSetIntoDB() {
		// 1. Loading & Write DB ratings datasets (ratings.csv)
		String dir = path+"\\movies.csv";
		try{
			 BufferedReader reader = new BufferedReader(new FileReader(dir));
			 String inputLine = null;
			 
			 String temp[] = null; int movieID; String title; String genres;
			 int count = -1;
			 while ((inputLine = reader.readLine()) != null){
				 if(count==-1) {
					 count++;
					 continue;
				 }
				 //System.out.println(inputLine);
			     //buffer.append(inputLine);
				
				 temp = inputLine.split(",");
				 if(temp.length != 3) continue;
				 
				 movieID = Integer.parseInt(temp[0]);
				 title = temp[1].replace("'", "\\'");
				 genres = temp[2].replace("'", "\\'").replaceAll("\\|", ",");
				 
				 count++;
				 System.out.println("["+count+"] \t"+movieID+"\t"+title+"\t"+genres);
				 
				 db.getStmt().executeUpdate("INSERT INTO `movielens`.`movies` (`itemID`, `title`, `genres`) "
				 		+ "VALUES ('"+movieID+"', '"+title+"', '"+genres+"');");
				 //System.exit(0);
			 }
			 reader.close();
			 //System.out.println(buffer.toString());
			 
		}catch(Exception e){
			System.err.println("loadMovieContentDataSetIntoDB error: "+e.getMessage());
		}
	}
}
